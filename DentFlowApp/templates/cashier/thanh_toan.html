{% extends 'layout/base.html' %}

{% block title %}Xác nhận thanh toán{% endblock %}

{% block content %}
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-7 col-lg-6">
                {% if phieu_dieu_tri %}
                    <form method="post" action={{ url_for('cashier_xac_nhan_thanh_toan', id=phieu_dieu_tri.id) }}>
                        <input type="hidden" name="phuong_thuc_thanh_toan" id="paymentMethodInput" value="CASH">
                        <div class="card shadow-sm border-0">
                            <div class="card-header bg-primary text-white text-center py-3">
                                <h4 class="mb-0 text-uppercase fw-bold">
                                    <i class="fa fa-file-invoice-dollar me-2"></i>Thanh toán viện phí
                                </h4>
                            </div>
                            <div class="card-body p-4">
                                <div class="d-flex justify-content-between border-bottom pb-2 mb-3">
                                    <span class="text-muted">Mã phiếu:</span>
                                    <span class="fw-bold text-dark">#{{ phieu_dieu_tri.id }}</span>
                                </div>

                                <div class="mb-3">
                                    <label class="small text-muted text-uppercase fw-bold">
                                        <i class="fa-solid fa-user"></i> Thông tin bệnh nhân
                                    </label>
                                    <div class="bg-light p-3 rounded mt-1">
                                        <h5 class="text-primary mb-1">{{ phieu_dieu_tri.ho_so_benh_nhan.ho_ten }}</h5>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    {% for ct in phieu_dieu_tri.get_ds_dich_vu %}
                                        {% include 'cashier/ds_dich_vu.html' %}
                                    {% endfor %}
                                </div>
                                <div class="mt-3 border-top pt-2">
                                    <label class="small text-muted text-uppercase fw-bold">
                                        <i class="fa-solid fa-coins"></i> VAT (10%)
                                    </label>
                                    <div class="bg-light p-3 rounded mt-1">
                                        <h5 class="text-danger   mb-1">
                                            {{ "{:,.0f}".format(phieu_dieu_tri.get_tong_tien * 0.1).replace(',', '.') }}
                                            ₫
                                        </h5>
                                    </div>
                                </div>
                                <div class="mt-3 border-top pt-2">
                                    <span class="d-block text-muted small">Tổng cộng phải thu</span>
                                    <div class="text-end"> <span class="fw-bold text-danger fs-4" id="tong-tien">
                                    {{ "{:,.0f}".format(phieu_dieu_tri.get_tong_tien + phieu_dieu_tri.get_tong_tien * 0.1).replace(',', '.') }} ₫
                                <input name="tong-tien-thu" hidden="{{ true }}"
                                       value="{{ phieu_dieu_tri.get_tong_tien + phieu_dieu_tri.get_tong_tien * 0.1 }}">
                                    </span>
                                    </div>
                                </div>

                                <div class="form-check mt-4">
                                    <input type="checkbox" class="form-check-input" id="confirmPayment">
                                    <label class="form-check-label user-select-none" for="confirmPayment">
                                        Xác nhận đã thu đủ số tiền trên từ bệnh nhân.
                                    </label>
                                </div>
                            </div>

                            <div class="card-footer bg-white p-3 d-flex justify-content-between">
                                <a href="{{ url_for('cashier_view') }}" class="btn btn-outline-secondary px-4">
                                    <i class="fa fa-arrow-left me-1"></i> Quay lại
                                </a>
                                <button type="submit" id="btnSubmit" disabled class="btn btn-success px-4 fw-bold">
                                    <i class="fa fa-check me-1"></i> Xác nhận thu
                                </button>
                            </div>
                        </div>
                    </form>
                {% else %}
                    <div class="alert alert-warning">Không tìm thấy phiếu</div>
                {% endif %}
            </div>

            <div class="col-md-5 col-lg-5">
                <div class="card shadow-sm sticky-top" style="top: 20px;">
                    <div class="card-header bg-primary text-white text-center py-3">
                        <h4 class="mb-0 text-uppercase fw-bold">
                            <i class="fas fa-money-check"></i> Phương thức
                        </h4>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="paymentList">
                            <button type="button" class="list-group-item list-group-item-action btn-pt active"
                                    data-value="1">
                                <i class="fas fa-money-bill me-2"></i> Tiền mặt
                            </button>
                            <button type="button" class="list-group-item list-group-item-action btn-pt"
                                    data-value="2">
                                <i class="fas fa-qrcode me-2"></i> Chuyển khoản VietQR
                            </button>
                            <button type="button" class="list-group-item list-group-item-action btn-pt"
                                    data-value="3">
                                <i class="fas fa-wallet me-2"></i> Chuyển khoản MOMO
                            </button>
                        </div>

                        <div id="qrCodeArea" class="d-none text-center p-4 border-top bg-light">
                            <p class="small text-muted mb-2">Quét mã để thanh toán</p>
                            <img id="qrImage" src="" class="img-fluid border rounded bg-white p-1"
                                 style="max-width: 200px;">
                            <p class="mt-2 fw-bold text-primary" id="qrNote"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        window.BANK_ENV_CONFIG = {
            BANK_ID: "{{ bank_config.bank_id }}",
            ACCOUNT_NO: "{{ bank_config.account_numb }}",
            TEMPLATE: "{{ bank_config.template }}"
        };
    </script>
    <script src="{{ url_for('static', filename='js/cashier.js') }}"></script>
{% endblock %}