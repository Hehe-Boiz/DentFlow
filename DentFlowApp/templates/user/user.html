{% extends 'layout/base.html' %}

{% block title %}Tài khoản{% endblock %}

{% block content %}
<div class="container py-2">
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm text-center p-4 border-0">
                <h5 class="fw-bold mb-0">{{ current_user.ho_ten or current_user.username }}</h5>
                <p class="text-muted small">Tham gia từ: {{ current_user.ngay_tao}}</p>
                <div class="position-relative d-inline-block mx-auto mb-3">
                    <img id="sidebarAvatar"
                         src="{{ current_user.avatar }}"
                         class="rounded-circle object-fit-cover shadow-sm"
                         style="width: 120px; height: 120px;" alt="Avatar">
                </div>

            </div>
        </div>
        <div class="col-md-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom-0 pt-3 px-4">
                    <ul class="nav nav-tabs card-header-tabs" id="profileTabs" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link active fw-bold" data-bs-toggle="tab" data-bs-target="#tab-account">
                                <i class="fas fa-user-shield me-2"></i>Tài khoản
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link fw-bold" data-bs-toggle="tab" data-bs-target="#tab-profile">
                                <i class="fas fa-id-card me-2"></i>Hồ sơ bệnh nhân
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link fw-bold" data-bs-toggle="tab" data-bs-target="#tab-booking">
                                <i class="fas fa-calendar-check me-2"></i>Lịch hẹn của tôi
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="card-body p-4">
                    <div class="tab-content">
                        {% block tab_account %}
                        {% include 'user/tab_account.html'%}
                        {% endblock %}


                        {% block tab_profile %}
                        {% include 'user/tab_profile.html'%}
                        {% endblock %}

                        <div class="tab-pane fade" id="tab-booking">
                            {% if lich_hen_list %}
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                    <tr>
                                        <th>Thời gian</th>
                                        <th>Dịch vụ</th>
                                        <th>Bác sĩ</th>
                                        <th>Trạng thái</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for lich in lich_hen_list %}
                                    <tr>
                                        <td>
                                            <div class="fw-bold">{{ lich.ngay_hen.strftime('%d/%m/%Y') }}</div>
                                            <div class="small text-muted">{{ lich.gio_hen }}</div>
                                        </td>
                                        <td>{{ lich.dich_vu.ten_dich_vu if lich.dich_vu else 'Khám tổng quát' }}</td>
                                        <td>
                                            {% if lich.bac_si %}
                                            BS. {{ lich.bac_si.ho_ten }}
                                            {% else %}
                                            <span class="text-muted fst-italic">Chưa chỉ định</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if lich.trang_thai.name == 'CHO_XAC_NHAN' %}
                                            <span class="badge bg-warning text-dark">Chờ xác nhận</span>
                                            {% elif lich.trang_thai.name == 'DA_XAC_NHAN' %}
                                            <span class="badge bg-primary">Đã xác nhận</span>
                                            {% elif lich.trang_thai.name == 'HOAN_THANH' %}
                                            <span class="badge bg-success">Hoàn thành</span>
                                            {% else %}
                                            <span class="badge bg-danger">Đã hủy</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <i class="far fa-calendar-times fa-3x mb-3"></i>
                                <p>Bạn chưa có lịch hẹn nào.</p>
                                <a href="/" class="btn btn-primary btn-sm">Đặt lịch ngay</a>
                            </div>
                            {% endif %}
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}